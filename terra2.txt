#–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ terraform


–ó–∞—á–µ–º –Ω—É–∂–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
–í Terraform –ª—é–±–æ–π –∫–æ–¥ ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–æ–¥ Terraform, –Ω–µ –∏–∑–º–µ–Ω—è—è –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥. –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª–∏ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö Terraform –∏ –¥–µ–ª–∞–µ—Ç –≤–∞—à –º–æ–¥—É–ª—å —Å–æ—Å—Ç–∞–≤–Ω—ã–º –∏ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º.

#–ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏
variable "image_id" {
  type = string
}

variable "security_group_ids" {
  description = "(Optional) - List of security group IDs."
  type        = list(string)
  default     = []
}

variable "access_policy" {
  description = "Access policy from other services to the PostgreSQL cluster."
  type = object({
    data_lens     = optional(bool, null)
    web_sql       = optional(bool, null)
    serverless    = optional(bool, null)
    data_transfer = optional(bool, null)
  })
  default = {}
}



–î–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–ª–æ–∫–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –Ω–æ —Ç–∞–∫–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ ‚Äî –ø–ª–æ—Ö–æ–π —Ç–æ–Ω –∏ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–¥–∞. –ú—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ (description), —Ç–∏–ø (type) –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (default), –µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞. –ù–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏–π —ç—Ç–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –º–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é terraform-docs –≤ –ø–æ–¥–æ–±–Ω–æ–º –≤–∏–¥–µ:



#–ê—Ä–≥—É–º–µ–Ω—Ç validation
–ë–ª–æ–∫ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –ø—Ä–æ–≤–µ—Ä–∫–∏, –æ–±—ã—á–Ω–æ –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö.


variable "pg_version" {
  description = "PostgreSQL version"
  type        = string
  default     = "15"
  validation {
    condition     = contains(["12", "12-1c", "13", "13-1c", "14", "14-1c", "15", "15-1c", "16"], var.pg_version)
    error_message = "Allowed PostgreSQL versions are 12, 12-1c, 13, 13-1c, 14, 14-1c, 15, 15-1c, 16."
  }
}

#–ê—Ä–≥—É–º–µ–Ω—Ç sensitive
–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≤—ã–≤–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ Terraform –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º sensitive = true –∑–∞–º–µ–Ω–∏—Ç –µ—ë –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –≤—ã–≤–æ–¥–µ –∫–æ–º–∞–Ω–¥ terraform plan –∏ terraform apply –Ω–∞ (sensitive value).

variable "user_information" {
  type = object({
    name    = string
    address = string
  })
  sensitive = true
}

resource "some_resource" "a" {
  name    = var.user_information.name
  address = var.user_information.address
}

Terraform will perform the following actions:

  # some_resource.a will be created
  + resource "some_resource" "a" {
      + name    = (sensitive value)
      + address = (sensitive value)
    }

Plan: 1 to add, 0 to change, 0 to destroy.


#–ê—Ä–≥—É–º–µ–Ω—Ç nullable
–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –±—ã—Ç—å –ø—Ä–∏—Å–≤–æ–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ null. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞—Ä–≥—É–º–µ–Ω—Ç—É –ø—Ä–∏—Å–≤–æ–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ true. 
–ü—Ä–∏–º–µ—Ä –Ω–∞–ø–∏—Å–∞–Ω–∏—è

variable "example" {
  type     = string
  nullable = false
}

–ü—Ä–æ—Å—Ç—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
‚≠êÔ∏è String ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤ Unicode, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è —Ç–µ–∫—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, hello).
‚≠êÔ∏è Number ‚Äî —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 15) –∏ –¥—Ä–æ–±–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 6,283185).
‚≠êÔ∏è Boolean ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (true –ª–∏–±–æ false), –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —É—Å–ª–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–µ.
–°–ª–æ–∂–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
üåü –ö–æ–ª–ª–µ–∫—Ü–∏–∏ ‚Äî –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Å—Ö–æ–∂–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π.
üåü –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ç–∏–ø—ã ‚Äî –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω–µ—Å—Ö–æ–∂–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π.
–°–ª–æ–∂–Ω—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π –≤ –æ–¥–Ω–æ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞–º–∏ —Ç–∏–ø–æ–≤. –£ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –µ—Å—Ç—å —É–∫–æ—Ä–æ—á–µ–Ω–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ –≤–µ—Ä—Å–∏–∏, –æ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã —Ä–∞—Å—Å–∫–∞–∂–µ–º.

–ö–æ–ª–ª–µ–∫—Ü–∏–∏, –∏–ª–∏ Collection
–ö–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ. –£ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —ç–ª–µ–º–µ–Ω—Ç–Ω—ã–π —Ç–∏–ø, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç –∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—É. –ù–∞–ø—Ä–∏–º–µ—Ä, list(strings) –æ–∑–Ω–∞—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫, list(numbers) ‚Äî —Å–ø–∏—Å–æ–∫ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

1Ô∏è‚É£ –ö–æ–ª–ª–µ–∫—Ü–∏—è list(‚Ä¶) 
–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ü–µ–ª—ã–º–∏ —á–∏—Å–ª–∞–º–∏, –Ω–∞—á–∏–Ω–∞—è —Å 0.
–ü—Ä–∏–º–µ—Ä—ã: 
list(string) ‚Äî —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä ["ru-central1-a", "ru-central-1b"].
list(number) ‚Äî —Å–ø–∏—Å–æ–∫ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä [4, 8, 15, 16, 23, 42].
list –∏–ª–∏ list(any) ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±–æ–π —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞, –Ω–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ–¥–∏–Ω —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏—Å–≤–æ–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ ["abc", "def"], –Ω–æ –Ω–µ –º–æ–∂–µ—Ç–µ ["abc", 123].


2Ô∏è‚É£ –ö–æ–ª–ª–µ–∫—Ü–∏—è map(‚Ä¶) 
–ö–æ–ª–ª–µ–∫—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π, –≤ –∫–æ—Ç–æ—Ä–æ–π –∫–∞–∂–¥–æ–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ–º. 
–ü—Ä–∏–º–µ—Ä—ã:
map(string) ‚Äî –∫–æ–ª–ª–µ–∫—Ü–∏—è –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä {owner = "DevOps", project = "infra"}.
map(number) ‚Äî –∫–æ–ª–ª–µ–∫—Ü–∏—è –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ —á–∏—Å–µ–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä {from_port: 8090, to_port = 8099}.
map –∏–ª–∏ map(any) ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±–æ–π —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞, –Ω–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ–¥–∏–Ω —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏—Å–≤–æ–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ {abc = "abc", def = "def"}, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç–µ {abc = "abc", def = 123}

3Ô∏è‚É£ –ö–æ–ª–ª–µ–∫—Ü–∏—è set(‚Ä¶)
–ö–æ–ª–ª–µ–∫—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, —É –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.
–ü—Ä–∏–º–µ—Ä—ã:
set(string) ‚Äî –∫–æ–ª–ª–µ–∫—Ü–∏—è —Å—Ç—Ä–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä ["apple", "cherry", "banana"].
set(number) ‚Äî –∫–æ–ª–ª–µ–∫—Ü–∏—è —á–∏—Å–µ–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä [101, 202, 303].
set –∏–ª–∏ set(any) ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±–æ–π —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞, –Ω–æ —É –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–∏–Ω —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏—Å–≤–æ–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ ["abc", "def"], –Ω–æ –Ω–µ –º–æ–∂–µ—Ç–µ ["abc", 123].

1Ô∏è‚É£ –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö object(‚Ä¶) 
–ö–æ–ª–ª–µ–∫—Ü–∏—è –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤, —É –∫–∞–∂–¥–æ–≥–æ –µ—Å—Ç—å —Å–≤–æ–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö. –°—Ö–µ–º–∞ –æ–±—ä–µ–∫—Ç–∞ –∑–∞–¥–∞—ë—Ç—Å—è –≤ –≤–∏–¥–µ {KEY1 = TYPE, KEY2 = TYPE, ...} ‚Äî –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø—è—Ç–æ–π. –ó–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–æ–π –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏, –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞ –¥–æ–ª–∂–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –µ–≥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É —Ç–∏–ø—É.

type = object({
    cloud_name  = string
    name        = string
    description = string
    labels      = map(string)
  })
  
value = {
  cloud_name  = "Yandex Cloud"
  name        = "infra-folder"
  description = "Infrastracture"
  labels      = {
    environment = "production"
    owner       = "DevOps"
  }
}  


–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö object(‚Ä¶) 
Terraform –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É, –∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –æ–±—ä–µ–∫—Ç–∞. –≠—Ç–æ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã. 
–ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ç –æ–±—ä–µ–∫—Ç–∞ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è optional(<TYPE>, <DEFAULT>). 
–û–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞:
<TYPE> ‚Äî —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–∞, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç.
<DEFAULT> ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–µ—Ä–µ–¥–∞–ª –∞—Ç—Ä–∏–±—É—Ç –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–ª null. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å —ç—Ç–æ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ null.
–í –ø—Ä–∏–º–µ—Ä–µ –æ–ø–∏—Å–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ PostgreSQL-–∫–ª–∞—Å—Ç–µ—Ä–∞, –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –æ–±—ä–µ–∫—Ç–∞ –≤ –Ω–µ–π –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏ —É –Ω–∏—Ö —É–∫–∞–∑–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

variable "performance_diagnostics" {
  description = "(Optional) - PostgreSQL cluster performance diagnostics settings."
  type = object({
    enabled                      = optional(bool, null)
    sessions_sampling_interval   = optional(number, 60)
    statements_sampling_interval = optional(number, 600)
  })
  default = {}
}


2Ô∏è‚É£ –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö tuple(...) 
–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è —Ü–µ–ª—ã–º–∏ —á–∏—Å–ª–∞–º–∏, –Ω–∞—á–∏–Ω–∞—è —Å 0, –ø—Ä–∏ —ç—Ç–æ–º —É –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–≤–æ–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö. –°—Ö–µ–º–∞ –∫–æ—Ä—Ç–µ–∂–∞ –∑–∞–¥–∞—ë—Ç—Å—è –≤ –≤–∏–¥–µ [TYPE, TYPE, ...] ‚Äî —Å–ø–∏—Å–∫–∞ —Ç–∏–ø–æ–≤, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø—è—Ç–æ–π. –ó–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å —Ç–æ –∂–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Ç–∏–ø –∑–Ω–∞—á–µ–Ω–∏–π, —á—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ —Å—Ö–µ–º–µ. 
–ü—Ä–∏–º–µ—Ä—ã:

type = tuple(string, number, bool)

value = ["example", 42, true]

#–û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º

variable "network_name" {
  description = "(Optional) - Name of the network."
  type        = string
}

resource "yandex_vpc_network" "this" {
  name = var.network_name
}
-----------------------
variable "labels" {
  description = "(Optional) - Set of label pairs to assing to the PostgreSQL cluster. Include the 'name' label."
  type        = map(string)
  default     = {
    name = "pgsql-cluster", 
    owner = "DevOps"
  }
}

variable "access_policy" {
  description = "(Optional) - Access policy from other services to the PostgreSQL cluster."
  type = object({
    data_lens     = optional(bool, null)
    web_sql       = optional(bool, null)
    serverless    = optional(bool, null)
    data_transfer = optional(bool, null)
  })
  default = {}
}

# PostgreSQL cluster
resource "yandex_mdb_postgresql_cluster" "this" {
name = var.labels["name"]
...
  config {
    access {
        data_lens     = var.access_policy.data_lens
        web_sql       = var.access_policy.web_sql
        serverless    = var.access_policy.serverless
        data_transfer = var.access_policy.data_transfer
    }
  }
  ...
}


#–ö–∞–∫ –∑–∞–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–∞–Ω–∞ —Ç—Ä–µ–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:
—Å –ø–æ–º–æ—â—å—é –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏;
–≤ —Ñ–∞–π–ª–∞—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π .tfvars;
—Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

#–ê—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥ terraform plan –∏ terraform apply –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é –æ–ø—Ü–∏–∏ -var:

$ terraform apply -var="image_id=fd8ne6e3etbrr2ve9nlc"
$ terraform apply -var='image_id_list=["fd8ne6e3etbrr2ve9nlc","fd8fsjddp35jvb4e4jo7"]' -var="cores=4"
$ terraform apply -var='subnet_map={"ru-central1-a":"subnet-a","ru-central1-b":"subnet-b"}'

#–§–∞–π–ª—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —É–¥–æ–±–Ω–æ —É–∫–∞–∑–∞—Ç—å –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏–º—Å—è –Ω–∞ .tfvars –∏–ª–∏ .tfvars.json. –ê –∑–∞—Ç–µ–º —É–∫–∞–∑–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ -var-file: 

–í —Ñ–∞–π–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–Ω–∏ –∑–∞–¥–∞—é—Ç—Å—è –≤ –≤–∏–¥–µ <NAME> = <VALUE>:
image_id = "fd8ne6e3etbrr2ve9nlc"
zone_names = [
  "ru-central1-a",
  "ru-central1-b",
]

–≤ json
{
"image_id": "fd8ne6e3etbrr2ve9nlc",
"zone_names" = ["ru-central1-a", "ru-central1-b"]
} 

Terraform —Ç–∞–∫–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ä—è–¥ —Ñ–∞–π–ª–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
—Ñ–∞–π–ª—ã —Å –∏–º–µ–Ω–∞–º–∏ terraform.tfvars –∏–ª–∏ terraform.tfvars.json;
–ª—é–±—ã–µ —Ñ–∞–π–ª—ã —Å –∏–º–µ–Ω–∞–º–∏, –æ–∫–∞–Ω—á–∏–≤–∞—é—â–∏–º–∏—Å—è –Ω–∞ .auto.tfvars –∏–ª–∏ .auto.tfvars.json.


#–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
Terraform –∏—â–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å TF_VAR_), –∑–∞ –∫–æ—Ç–æ—Ä—ã–º —Å–ª–µ–¥—É–µ—Ç –∏–º—è –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.
–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è Terraform –∏–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–∞–Ω–¥ Terraform —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏. 

$ export TF_VAR_image_id=fd8ne6e3etbrr2ve9nlc
$ terraform plan

#–ü–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö 

1Ô∏è‚É£ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
2Ô∏è‚É£ –§–∞–π–ª terraform.tfvars, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å.
3Ô∏è‚É£ –§–∞–π–ª terraform.tfvars.json, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å.
4Ô∏è‚É£ –õ—é–±—ã–µ —Ñ–∞–π–ª—ã *.auto.tfvars –∏–ª–∏ *.auto.tfvars.json, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –∏—Ö –∏–º—ë–Ω.
5Ô∏è‚É£ –õ—é–±—ã–µ –æ–ø—Ü–∏–∏ -var –∏ -var-file –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.

üí° –ë–æ–ª–µ–µ –ø–æ–∑–¥–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏–º–∏.


#–ü—Ä–∞–∫—Ç–∏–∫–∞

export YC_TOKEN=$(yc iam create-token)
export YC_CLOUD_ID=$(yc config get cloud-id)
export YC_FOLDER_ID=$(yc config get folder-id)
terraform init
terraform plan
terraform apply
terraform apply -var-file=testing.tfvars


#Terraform local –∏ output values


Local values, –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
–õ–æ–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –∑–Ω–∞—á–µ–Ω–∏–π –∏–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ü—Ä–∏ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ–Ω–∏ –º–æ–≥—É—Ç —É—Å–ª–æ–∂–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –±—É–¥—É—â–µ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è, —Å–∫—Ä—ã–≤–∞—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è.
–í –ø—Ä–∏–º–µ—Ä–µ –Ω–∏–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è boot_disk_name –∏ linux_vm_name –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º—ë–Ω —Ä–µ—Å—É—Ä—Å–æ–≤, —á—Ç–æ–±—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –±—ã—Å—Ç—Ä–æ –ø–æ–º–µ–Ω—è—Ç—å —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è. –õ–æ–∫–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ labels –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤ –∫–∞–∂–¥–æ–º —Ä–µ—Å—É—Ä—Å–µ. 

locals {
  boot_disk_name      = "${var.name_prefix}-boot-disk"
  linux_vm_name       = "${var.name_prefix}-linux-vm"
 
  labels = {
      owner = "DevOps"
      env   = "dev"
  } 
}

resource "yandex_compute_disk" "boot_disk" {
  name = local.boot_disk_name

...

labels = local.labels
}

resource "yandex_compute_instance" "this" {
  name = local.linux_vm_name

...

  labels = local.labels
}

resource "yandex_vpc_subnet" "this" {
...

labels = local.labels
}


#–ö–∞–∫ –æ–±—ä—è–≤–ª—è—Ç—å

locals {
  service_name = "web-server"
  owner        = "DevOps"
}


locals {
  function_name = coalesce(var.function_name, "${var.name_prefix}-function")
  folder_id     = var.folder_user_role_mapping == [] && var.sa_role_mapping == [] ? data.yandex_client_config.client.folder_id : var.folder_id
  
  common_labels = {
    Service = "web-server"
    Owner   = "DevOps"
  }
}


–ö–∞–∫ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º

resource "compute_instance" "this" {
  # ...

  tags = local.common_labels
}


#Output values, –∏–ª–∏ –≤—ã—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

–í—ã—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –∏ –º–æ–≥—É—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥—Ä—É–≥–∏–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ Terraform. 
–í—ã—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤:
–ö–æ—Ä–Ω–µ–≤–æ–º –º–æ–¥—É–ª–µ
–î–ª—è –≤—ã–≤–æ–¥–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ CLI –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ terraform apply.
–î–æ—á–µ—Ä–Ω–µ–º –º–æ–¥—É–ª–µ
–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞–±–æ—Ä –∞—Ç—Ä–∏–±—É—Ç–æ–≤ —Å–≤–æ–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –º–æ–¥—É–ª—é. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –º–æ–¥—É–ª–µ–π –≤ Terraform –≤—ã —É–∑–Ω–∞–µ—Ç–µ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Ç–µ–º–∞—Ö.
–†–µ—Å—É—Ä—Å—ã, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ Terraform, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –∞—Ç—Ä–∏–±—É—Ç—ã. –ò—Ö –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç—è—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –í—ã—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–∞—à–µ–≥–æ –º–æ–¥—É–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã.

#–ö–∞–∫ –æ–±—ä—è–≤–ª—è—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
output "cluster_id" {
  description = "PostgreSQL cluster ID"
  value       = yandex_mdb_postgresql_cluster.this.id
}

output "ydb_id" {
  description = "The ID of the Yandex Managed Service for YDB instance."
  value       = yandex_ydb_database_serverless.this.id
  sensitive   = true
}

#–ü—Ä–∞–∫—Ç–∏–∫–∞

output "access_key_value" {
  value       = yandex_iam_service_account_static_access_key.this.service_account_id
  sensitive   = true
}


-------------


#–§—É–Ω–∫—Ü–∏–∏


max(2, 4, 18) 


Terraform –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏


variable "value" {
  default = "hello"
}

output "transformed_value" {
  value = upper(concat("transformed: ", var.value))
} 

variable "value" {
  default = "hello"
}

output "transformed_value" {
  value = upper(concat("transformed: ", var.value))
}
 
–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏: 
concat ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å—Ç—Ä–æ–∫–∏;
upper ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä.
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π value ("hello") —Å–Ω–∞—á–∞–ª–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "transformed: ", –∞ –∑–∞—Ç–µ–º –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä.


#–†–∞–±–æ—Ç–∞ —Å —á–∏—Å–ª–∞–º–∏
–§—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ (min) –∏–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ (max) –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –Ω–∞–±–æ—Ä–∞ —á–∏—Å–µ–ª –∏–ª–∏ –¥–ª—è –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è ‚Äî floor, ceil.
–ü—Ä–∏–º–µ—Ä:
timeout = min(var.timeout, 30) 
–ó–∞–¥–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∞–π–º-–∞—É—Ç–∞ –Ω–µ –≤—ã—à–µ 30.

#–†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏
–§—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–º–æ—â—å—é replace –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –ø–æ–¥—Å—Ç—Ä–æ–∫—É, —Å –ø–æ–º–æ—â—å—é substr ‚Äî –ø–æ–ª—É—á–∏—Ç—å —á–∞—Å—Ç—å —Å—Ç—Ä–æ–∫–∏, –∞ –±–ª–∞–≥–æ–¥–∞—Ä—è —Ñ—É–Ω–∫—Ü–∏–∏ format ‚Äî –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å –≤ —Å—Ç—Ä–æ–∫—É –¥—Ä—É–≥–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è. 
–ü—Ä–∏–º–µ—Ä: 
domain_name = replace(data.yandex_api_gateway.this.domain, "https://", "") 
–ß–∞—Å—Ç—å —Å—Ç—Ä–æ–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è https://, –±—É–¥–µ—Ç –æ—Ç–±—Ä–æ—à–µ–Ω–∞ (–∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É).


#–†–∞–±–æ—Ç–∞ —Å –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏
–§—É–Ω–∫—Ü–∏–∏ flatten, length, map, list, sort –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–π –¥–∞–Ω–Ω—ã—Ö. –§—É–Ω–∫—Ü–∏—è flatten –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫.

variable "cidr_blocks" {
  type = map(list(string))
  default = {
    ru-central1-a = ["192.168.1.0/24", "192.168.2.0/24", "192.168.3.0/24"],
    ru-central1-b = ["192.168.4.0/24", "192.168.5.0/24"],
    ru-central1-d = ["192.168.6.0/24", "192.168.7.0/24", "192.168.8.0/24", "192.168.9.0/24"],
  }
}

output "all_cidr_blocks" {
  value = flatten(values(var.cidr_blocks))
}
 

  + all_cidr_blocks = [
      + "192.168.1.0/24",
      + "192.168.2.0/24",
      + "192.168.3.0/24",
      + "192.168.4.0/24",
      + "192.168.5.0/24",
      + "192.168.6.0/24",
      + "192.168.7.0/24",
      + "192.168.8.0/24",
      + "192.168.9.0/24",
    ]
#–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ 

–§—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç—ã base64, JSON, YAML –∏ –¥—Ä—É–≥–∏–µ. 
–ü—Ä–∏–º–µ—Ä:
locals {
  encoded_secret_key = base64encode(var.secret_key)
} 


#–û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
–§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –ø–æ–º–æ—â—å—é fileexists, —á–∏—Ç–∞—é—Ç –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å –ø–æ–º–æ—â—å—é file –∏ —Å–æ–∑–¥–∞—é—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞ —Å –ø–æ–º–æ—â—å—é templatefile. 
–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ.
–ù–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞ backend.tftpl:
url = "${url}"
secret_key = "${secret_key}"  
output "backend_config" {
  value = templatefile("backend.tftpl", {
    url        = "https://example.com:8000",
    secret_key = "3njfui34fw3f3qh93"})

} 
–ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
  backend_config = <<-EOT
        url = "https://example.com:8000"
        secret_key = "3njfui34fw3f3qh93"
    EOT 

#–†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º
–§—É–Ω–∫—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å UTC Timestamp —Å –ø–æ–º–æ—â—å—é timestamp, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å –ø–æ–º–æ—â—å—é formatdate.
–ü—Ä–∏–º–µ—Ä:
locals {
  datetime   = formatdate("YYYY-MM-DD.hh-mm-ss", timestamp())
  object_key = "${var.project_name}_${local.datetime}.zip"
}

resource "yandex_storage_object" "cute-cat-picture" {
...
  key = local.object_key
...
} 

#–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏
–§—É–Ω–∫—Ü–∏–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ Terraform –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –∫–ª—é—á–µ–π –∏ –ø–æ–¥–ø–∏—Å–µ–π –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏ —Ä–µ—Å—É—Ä—Å–æ–≤. 
–ü—Ä–∏–º–µ—Ä:
resource "yandex_storage_object" "cute-cat-picture" {
...
  source_hash = filemd5("./object.zip")
...
} 
–§—É–Ω–∫—Ü–∏—è filemd5 –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞, –∫–æ–≥–¥–∞ –ø–æ–º–µ–Ω—è–ª–æ—Å—å –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ. 


#–†–∞–±–æ—Ç—ã —Å —Å–µ—Ç–µ–≤–æ–π CIDR
–§—É–Ω–∫—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å–µ—Ç–µ–≤—ã–º–∏ CIDR-–±–ª–æ–∫–∞–º–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ñ—É–Ω–∫—Ü–∏—è cidrhost –∫–∞–ª—å–∫—É–ª–∏—Ä—É–µ—Ç –∞–¥—Ä–µ—Å —Ö–æ—Å—Ç–∞, —Ñ—É–Ω–∫—Ü–∏—è cidrnetmask –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–µ—Ç–µ–≤—É—é –º–∞—Å–∫—É. 
–ü—Ä–∏–º–µ—Ä: 
variable "subnet_a_vpc_2" {
  default = "10.161.1.0/24"
}

resource "yandex_compute_instance" "this" {
  network_interface {
...
    ip_address = "${cidrhost(var.subnet_a_vpc_2, 10)}"
...
  }
} 
–§—É–Ω–∫—Ü–∏—è cidrhost –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è IP-–∞–¥—Ä–µ—Å–∞ —Ö–æ—Å—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º –≤ –∑–∞–¥–∞–Ω–Ω–æ–π –ø–æ–¥—Å–µ—Ç–∏. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è IP-–∞–¥—Ä–µ—Å–∞ –¥–µ—Å—è—Ç–æ–≥–æ —Ö–æ—Å—Ç–∞ –≤ –ø–æ–¥—Å–µ—Ç–∏ subnet_a_vpc_2

–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
–§—É–Ω–∫—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ñ—É–Ω–∫—Ü–∏—è tonumber –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö number, try ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤–æ–µ –≤–∞–ª–∏–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. 
–ü—Ä–∏–º–µ—Ä: 
resource "yandex_kms_symmetric_key" "this" {
  ...
  name  = try(coalesce(var.sse_kms_key_configuration.name, local.sse_kms_master_key_name), null)
  ...
}   
–≠—Ç–æ—Ç –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é coalesce, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –ª–∏–±–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π var.sse_kms_key_configuration.name, –ª–∏–±–æ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é local.sse_kms_master_key_name, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç null —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ try, –µ—Å–ª–∏ –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.

#–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
–í—ã –º–æ–∂–µ—Ç–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ Terraform –∏–∑ –∫–æ–Ω—Å–æ–ª–∏, –∑–∞–ø—É—Å—Ç–∏–≤ –∫–æ–º–∞–Ω–¥—É terraform console:
$ terraform console

> max(2, 4, 18)
18

> cidrnetmask("172.16.0.0/12")
"255.240.0.0" 
–ö–æ–º–∞–Ω–¥–∞ terraform console —Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Terraform –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ –∏ —Ñ–∞–π–ª–∞ state ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

$ echo 'ceil(0.79)' | terraform console
1 

---------
#–ü—Ä–∞–∫—Ç–∏–∫–∞

_______________

–£—Å–ª–æ–≤–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
–£—Å–ª–æ–≤–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏–≥—Ä–∞—é—Ç –≤–∞–∂–Ω—É—é —Ä–æ–ª—å –≤ Terraform, –ø–æ–∑–≤–æ–ª—è—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π.
–°–∏–Ω—Ç–∞–∫—Å–∏—Å —É—Å–ª–æ–≤–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ Terraform —Å–ª–µ–¥—É—é—â–∏–π:
condition ? true_value : false_value 

–£—Å–ª–æ–≤–∏—è –º–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å:
var.name == "" ? var.default != null? var.default : "default_name" : var.name  
–í –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ –≤ —Å–ª—É—á–∞–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ä–∞–≤–Ω–æ–≥–æ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–µ, —É –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π name –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π default. –ï—Å–ª–∏ –∂–µ –æ–Ω–æ –Ω–µ –∑–∞–¥–∞–Ω–æ, —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ—Ç —Å—Ç—Ä–æ–∫–∞ default-name. –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–æ –∏–∑ —É—Å–ª–æ–≤–∏–π –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π name.


#–û–ø–µ—Ä–∞—Ç–æ—Ä—ã
–° —É—Å–ª–æ–≤–Ω—ã–º–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞, —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã. –í Terraform –æ–Ω–∏ –∏–º–µ—é—Ç —Å–ª–µ–¥—É—é—â–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:
–û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞
a == b –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, –µ—Å–ª–∏ a –∏ b –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ç–∏–ø –∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∏–ª–∏ false –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ.
a != b –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ—Å—Ç—å a == b.
–û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
a < b –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, –µ—Å–ª–∏ a –º–µ–Ω—å—à–µ b, –∏ false –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ.
a <= b –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, –µ—Å–ª–∏ a –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ b, –∏ false –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ.
a > b –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, –µ—Å–ª–∏ a –±–æ–ª—å—à–µ b, –∏ false –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ.
a >= b –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, –µ—Å–ª–∏ a –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ b, –∏ false –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ.
–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
a || b –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∏–∑ –≤—ã—Ä–∞–∂–µ–Ω–∏–π a –∏–ª–∏ b –∏—Å—Ç–∏–Ω–Ω–æ, –∏–ª–∏ false, –µ—Å–ª–∏ –æ–±–∞ –ª–æ–∂–Ω—ã.
a && b –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, –µ—Å–ª–∏ –æ–±–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è a –∏ b –∏—Å—Ç–∏–Ω–Ω—ã, –∏–ª–∏ false, –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∏–∑ –Ω–∏—Ö –ª–æ–∂–Ω–æ.
!a –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, –µ—Å–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ a –ª–æ–∂–Ω–æ, –∏ false, –µ—Å–ª–∏ –æ–Ω–æ –∏—Å—Ç–∏–Ω–Ω–æ.

locals {
 # –ï—Å–ª–∏ –¥–ª–∏–Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–π —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö `custom_ingress_rules` –∏–ª–∏ `custom_egress_rules` –≤—ã—à–µ 0, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ—Ç `true`, –∏–Ω–∞—á–µ `false` 
 create_sg = length(var.custom_ingress_rules) > 0 || length(var.custom_egress_rules) > 0 ? true : false
 
 # –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `create_kms` –∏—Å—Ç–∏–Ω–Ω–æ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `create_sa` –∏—Å—Ç–∏–Ω–Ω–æ, —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ—Ç `true`, –∏–Ω–∞—á–µ `false`   
 create_binding = var.create_kms && local.create_sa ? true : false
} 


–í—ã—Ä–∞–∂–µ–Ω–∏–µ for
–í—ã—Ä–∞–∂–µ–Ω–∏–µ for —Å–æ–∑–¥–∞—ë—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–æ–±—Ä–∞–∑—É—è –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö. 
–ü—Ä–∏–º–µ—Ä:
[for s in var.list : upper(s)] 
–≠—Ç–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π list –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ upper(s). –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∏—Ç—Å—è tuple(string) —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä.
–í—ã—Ä–∞–∂–µ–Ω–∏–µ for –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–∞–∫–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, –∫–∞–∫ list, set, tuple, map, object.
–í—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ s, –Ω–æ –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏ –¥–≤–∞:
[for k, v in var.map : length(k) + length(v)] 
 –î–ª—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö map –∏ object –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ k ‚Äî –∫–ª—é—á –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞ –æ–±—ä–µ–∫—Ç–∞, v ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ.
–ù–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–µ–¥—É—é—â–µ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤–µ—Ä–Ω—ë—Ç —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ c –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–µ—Ä–≤–µ—Ä–æ–≤:
variable "servers_count" {
  default = {
    "db" = 3,
    "frontend" = 2,
    "backend" = 5,
    "balancer" = 1
  }
}

output "servers" {
  value = [for k, v in var.servers_count: 
    "${k} has ${v} servers"
  ]
} 
Outputs:

servers = [
  "backend has 5 servers",
  "balancer has 1 servers",
  "db has 3 servers",
  "frontend has 2 servers",
] 
–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å–æ —Å–ø–∏—Å–∫–∞–º–∏ —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–Ω–¥–µ–∫—Å —ç–ª–µ–º–µ–Ω—Ç–∞, –Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å 0, –∞ –≤—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ:
[for i, v in var.list : "${i} is ${v}"] 
–í–º–µ—Å—Ç–æ —Å–∏–º–≤–æ–ª–æ–≤ k, i, v –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ —Å–∏–º–≤–æ–ª—ã –∏–ª–∏ —Å–ª–æ–≤–∞, –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ –ª—É—á—à–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
–°–∫–æ–±–∫–∏ –≤–æ–∫—Ä—É–≥ –≤—ã—Ä–∞–∂–µ–Ω–∏—è for –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, –∫–∞–∫–∏–º –±—É–¥–µ—Ç —Ç–∏–ø —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞:
–∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏ [ ] ‚Äî tuple;
—Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏ { } ‚Äî object.
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å–∏–º–≤–æ–ª =>:
{for s in var.list : s => upper(s)} 
–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞–Ω–µ—Ç:
{
  aaa = "AAA"
  bbb = "BBB"
  ccc = "CCC"
} 


#–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
–í –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ for –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è if:
[for s in var.list : upper(s) if s != ""] 
–í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫.


#–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ count
–ï—Å–ª–∏ –±–ª–æ–∫ —Ä–µ—Å—É—Ä—Å–∞ –∏–ª–∏ –º–æ–¥—É–ª—è –≤–∫–ª—é—á–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç count, –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —è–≤–ª—è–µ—Ç—Å—è —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º, Terraform —Å–æ–∑–¥–∞—Å—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤.
–ö–∞–∂–¥–æ–º—É —ç–∫–∑–µ–º–ø–ª—è—Ä—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∏ –∫–∞–∂–¥—ã–π –∏–∑ –Ω–∏—Ö —Å–æ–∑–¥–∞—ë—Ç—Å—è, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–ª–∏ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
–í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ —Å –ø–æ–º–æ—â—å—é count = 5 –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ 5 –í–ú:
resource "yandex_compute_instance" "this" {
    count = 5
    
  name        = "Server ${count.index}"
  platform_id = "standard-v1"
  zone        = "ru-central1-a"

  resources {
    cores  = 2
    memory = 4
  }


#–û–±—Ä–∞—â–µ–Ω–∏–µ –∫ —ç–∫–∑–µ–º–ø–ª—è—Ä—É
–ï—Å–ª–∏ –∑–∞–¥–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ count, Terraform –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Å –ø–æ–º–æ—â—å—é –∏–Ω–¥–µ–∫—Å–∞, –Ω–∞—á–∏–Ω–∞—é—â–µ–≥–æ—Å—è —Å 0. –û–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —ç–∫–∑–µ–º–ø–ª—è—Ä—É —Å–ª–µ–¥—É–µ—Ç —Å –ø–æ–º–æ—â—å—é –≤—ã—Ä–∞–∂–µ–Ω–∏—è:
<TYPE>.<NAME>[<INDEX>] 
–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –í–ú –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤—ã—à–µ —ç—Ç–æ –±—É–¥–µ—Ç yandex_compute_instance.this[0], yandex_compute_instance.this[1] –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

  boot_disk {
    initialize_params {
      image_id = "fd833v6c5tb0udvk4jo6"
    }
  }

  network_interface {
    subnet_id = yandex_vpc_subnet.this.id
  }
} 

–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω—ã–π –≤—ã—à–µ –∫–æ–¥ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å for_each, —á—Ç–æ–±—ã —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —É–¥–∞–ª–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∏–∑-–∑–∞ –∑–∞–º–µ–Ω—ã –∏–Ω–¥–µ–∫—Å–æ–≤:
# –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
variable "instance_map" {
  default = {
    "web" = "web-server",
    "app" = "app-server",
    "db"  = "db-server"
  }
}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ for_each –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
resource "yandex_compute_instance" "this" {
  for_each = var.instance_map

  name = each.value
  
  ...
}

# –í—ã–≤–æ–¥, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –∏–º–µ–Ω–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
output "instance_tags" {
  value = [for k, v in var.instance_map : v]
} 


#–ê—Ä–≥—É–º–µ–Ω—Ç for_each –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–µ —Å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º for –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π:
variable "databases" {
  description = "List of PostgreSQL databases."

  type = list(object({
    name                = string
    owner               = string
    lc_collate          = optional(string, null)
    lc_type             = optional(string, null)
    template_db         = optional(string, null)
    deletion_protection = optional(bool, null)
    extensions          = optional(list(string), [])
  }))
}

resource "yandex_mdb_postgresql_database" "database" {
  for_each = length(var.databases) > 0 ? { for db in var.databases : db.name => db } : {}

  name = each.value.name
...
} 
–í –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Ä–µ—Å—É—Ä—Å —Ç–∏–ø–∞ yandex_mdb_postgresql_database –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

#–û–±—Ä–∞—â–µ–Ω–∏–µ –∫ —ç–∫–∑–µ–º–ø–ª—è—Ä—É
–ï—Å–ª–∏ –∑–∞–¥–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ for_each, —Ç–æ Terraform –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Å –ø–æ–º–æ—â—å—é –∫–ª—é—á–∞. –û–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —ç–∫–∑–µ–º–ø–ª—è—Ä—É —Å–ª–µ–¥—É–µ—Ç —Å –ø–æ–º–æ—â—å—é –≤—ã—Ä–∞–∂–µ–Ω–∏—è:
<TYPE>.<NAME>[<KEY>] 
–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –í–ú –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤—ã—à–µ —ç—Ç–æ –±—É–¥–µ—Ç yandex_compute_instance.this["server-1"], yandex_compute_instance.this["server-2"] –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–∏–ø—ã —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ –≤ —Å–≤–æ–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö, –æ–±—ã—á–Ω–æ –æ–Ω–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π –æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã.
resource "yandex_vpc_security_group" "this" {
...
  ingress {
    protocol       = "TCP"
    description    = "HTTP"
    v4_cidr_blocks = ["10.0.1.0/24"]
    port           = 80
  }
  
  ingress {
    protocol       = "TCP"
    description    = "HTTPS"
    v4_cidr_blocks = ["0.0.0.0/0"]
    port           = 443
  }  
...
} 
–í—ã –º–æ–∂–µ—Ç–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Å –ø–æ–º–æ—â—å—é dynamic-–±–ª–æ–∫–æ–≤. –û–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–æ–≤ resource, data, provider –∏ provisioner.
–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–¥–æ–±–Ω–æ for_each: –∏—Ç–µ—Ä–∏—Ä—É—è –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é —Å–ª–æ–∂–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞—é—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏. 
–í –ø—Ä–∏–º–µ—Ä–µ –Ω–∏–∂–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–≤–∞ –±–ª–æ–∫–∞ ingress, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ —É–∫–∞–∑–∞–Ω–Ω—ã–º –≤—ã—à–µ, —Å –∏—Ç–µ—Ä–∞—Ü–∏–µ–π –ø–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π ingress_rules.
variable "ingress_rules" {
  type = list(object({
    protocol       = string
    description    = string
    v4_cidr_blocks = list(string)
    port           = number
  }))
  default = [
    {
      protocol       = "TCP"
      description    = "HTTP"
      v4_cidr_blocks = ["10.0.1.0/24"]
      port           = 80
    },
    {
      protocol       = "TCP"
      description    = "HTTPS"
      v4_cidr_blocks = ["0.0.0.0/0"]
      port           = 443
    }
  ]
}

resource "yandex_vpc_security_group" "this"
...
  dynamic "ingress" {
    for_each = var.ingress_rules
    content {
      protocol       = ingress.value.protocol
      description    = ingress.value.description
      port           = ingress.value.port
      v4_cidr_blocks = ingress.value.v4_cidr_blocks
    }
...
} 
–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ:
–ò–º—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –±–ª–æ–∫–∞ ingress —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–æ–π –≤–∏–¥ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å.
–ê—Ä–≥—É–º–µ–Ω—Ç for_each –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∏—Ç–µ—Ä–∞—Ü–∏–∏.
–í–ª–æ–∂–µ–Ω–Ω—ã–π –±–ª–æ–∫ content –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞.
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Ç–∏–ø—ã —Ä–µ—Å—É—Ä—Å–æ–≤, –≤–∫–ª—é—á–∞—é—â–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã –º–æ–∂–µ—Ç–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –≤–ª–æ–∂–∏–≤ dynamic-–±–ª–æ–∫–∏ –≤ content –¥—Ä—É–≥–∏—Ö dynamic-–±–ª–æ–∫–æ–≤.

#–£–∫–∞–∑–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ Terraform —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏. –í–∞–º –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –∫–æ–≥–¥–∞ —Ä–µ—Å—É—Ä—Å –∏–ª–∏ –º–æ–¥—É–ª—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏—è –¥—Ä—É–≥–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞, –Ω–æ –Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –¥–∞–Ω–Ω—ã–º —ç—Ç–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –≤ —Å–≤–æ–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö.
–î–ª—è —É–∫–∞–∑–∞–Ω–∏—è —è–≤–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞—Ä–≥—É–º–µ–Ω—Ç depends_on. –û–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç Terraform –∑–∞–≤–µ—Ä—à–∏—Ç—å –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –æ–±—ä–µ–∫—Ç–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –¥–µ–π—Å—Ç–≤–∏–π —Å –æ–±—ä–µ–∫—Ç–æ–º, –æ–±—ä—è–≤–ª—è—é—â–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å. 



