–ö–æ–¥ –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è Managed Service for YDB:

terraform {
  required_providers {
    yandex = {
      source = "yandex-cloud/yandex"
    }
  }
  required_version = ">= 0.13"
}

provider "yandex" {
  zone = "ru-central1-a"
}

resource "yandex_ydb_database_serverless" "this" {
  name = "test-ydb-serverless"
} 

# terraform init 

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è backend –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è state
State —Ö—Ä–∞–Ω–∏—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π Terraform. Backend –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –≥–¥–µ Terraform —Ö—Ä–∞–Ω–∏—Ç state
.
–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
–ü—Ä–æ–≤–∞–π–¥–µ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å Yandex Cloud.

–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π, –µ—Å–ª–∏ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
–ú–æ–¥—É–ª–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ Terraform, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –µ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –≤ —Ä–∞–º–∫–∞—Ö –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

#terraform plan 

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Terraform —Å —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–ê—Ç—Ä–∏–±—É—Ç—ã –≤ –ø–ª–∞–Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç—Ä–∞–∂–µ–Ω—ã –∫–∞–∫ known after apply:

–ï—Å–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –≤ –∫–æ–¥–µ –Ω–µ —É–∫–∞–∑–∞–Ω—ã. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ–º –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏—Ö default-–∑–Ω–∞—á–µ–Ω–∏—è.
–ï—Å–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä id, created_at.

üíª –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–Ω –≤ —Ñ–∞–π–ª, —á—Ç–æ–±—ã –ø–æ–∑–¥–Ω–µ–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –µ–≥–æ:
$ terraform plan -out=<PLAN_FILE> 

#terraform apply

–ö–æ–≥–¥–∞ –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∂–µ–ª–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–¥ –∏ —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É. –í —ç—Ç–æ–º –ø–æ–º–æ–∂–µ—Ç –∫–æ–º–∞–Ω–¥–∞:

terraform apply <PLAN_FILE> 

Apply complete! Resources: 1 added, 0 changed, 0 destroyed


#–°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç

yc iam service-account create --name terrabot

yc resource-manager folder add-access-binding b*** --role editor --subject serviceAccount:aj****

yc resource-manager folder add-access-binding bo --role admin --subject serviceAccount:a 




yc iam key create \
  --service-account-id aje* > \
  --folder-name b1g*o \
  --output key.json


yc config set service-account-key key.json
yc config set cloud-id b*
yc config set folder-id b1*


export YC_TOKEN=$(yc iam create-token)
export YC_CLOUD_ID=$(yc config get cloud-id)
export YC_FOLDER_ID=$(yc config get folder-id)

#C–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—É—é infra-stage

terraform init

terraform plan - —Å–º–æ—Ç—Ä–∏–º –ø–ª–∞–Ω

terraform apply - –ø—Ä–∏–º–µ–Ω—è–µ–º

terraform destroy 

terraform apply -replace="random_string.bucket_name" - –∑–∞–º–µ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å

terraform init --upgrade - –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

