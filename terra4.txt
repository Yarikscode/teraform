#–ü—Ä–æ–≤–∏–∂–∏–Ω–∏–Ω–≥ –≤ Terraform
–†–∞—Å—Å–∫–∞–∂–µ–º –ø—Ä–æ —Ç—Ä–∏ —Ç–∏–ø–∞ –ø—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä–æ–≤:
file ‚Äî –∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—É—é;
local-exec ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ;
remote-exec ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ.

#–ü—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä file
–ü—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä file –∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –º–∞—à–∏–Ω—ã, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø—É—â–µ–Ω Terraform, –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—É—é –º–∞—à–∏–Ω—É. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ SSH –∏ WinRM. 
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞:
source
–ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è. –ú–æ–∂–µ—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω –∫–∞–∫ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π, —Ç–∞–∫ –∏ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å. –≠—Ç–æ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å content.
content
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Å—Ç–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è. –ú–µ—Å—Ç–æ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Ñ–∞–π–ª –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è. –ï—Å–ª–∏ –º–µ—Å—Ç–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è, –≤ –Ω–µ–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º tf-file-content. –≠—Ç–æ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å source.
destination
–ú–µ—Å—Ç–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ.

#–ü—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä local-exec
–ü—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä local-exec –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–∞ –º–∞—à–∏–Ω–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Terraform.
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:
command (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç) ‚Äî –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
working_dir (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç) ‚Äî —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞. –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —Ç–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è.
interpreter (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç) ‚Äî —Å–ø–∏—Å–æ–∫ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä ["/bin/bash", "-c"]. –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –û–°.
environment (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç) ‚Äî —Å–ø–∏—Å–æ–∫ –ø–∞—Ä <–∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ>, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∑–∞–¥–∞–Ω—ã –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
when (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç) ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ —Å–ª–µ–¥—É–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É, –Ω–∞–ø—Ä–∏–º–µ—Ä when = destroy –∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–∞. –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –ø—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–∞.
quiet (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç) ‚Äî –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ true, —Ç–æ Terraform –Ω–µ –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å —Å–∞–º—É –∫–æ–º–∞–Ω–¥—É –≤ stdout, —Ç–µ–º –Ω–µ –º–µ–Ω–µ–µ –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ. –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, —Ç–æ Terraform –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –∏ –µ—ë –≤—ã–≤–æ–¥ –≤ stdout.

resource "yandex_compute_instance" "this" {
...

  provisioner "local-exec" {
    command = "yc compute instance stop ${self.id}"
  }
}

#–ü—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä remote-exec
–ü—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä remote-exec –≤—ã–∑—ã–≤–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ SSH –∏ WinRM. 
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:
inline ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ.
script ‚Äî –ø—É—Ç—å –¥–æ —Å–∫—Ä–∏–ø—Ç–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –∏ –∑–∞–ø—É—â–µ–Ω –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ.
scripts ‚Äî —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π –¥–æ —Å–∫—Ä–∏–ø—Ç–æ–≤ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö —É–∫–∞–∑–∞–Ω–∏—è.
–ü—É—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω—ã –∫–∞–∫ –≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–º, —Ç–∞–∫ –∏ –≤ –∞–±—Å–æ–ª—é—Ç–Ω–æ–º –≤–∏–¥–µ.
üí° –ê—Ä–≥—É–º–µ–Ω—Ç—ã –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ: —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞—Ä–≥—É–º–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä–∞.
–í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω —Å–∫—Ä–∏–ø—Ç bootstrap.sh:
resource "yandex_compute_instance" "web" {
...
  provisioner "remote-exec" {
    script = [
      "./bootstrap.sh"
    ]
  }
} 

#–ë–ª–æ–∫ connection
–ü—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä—ã file –∏ remote-exec —Ç—Ä–µ–±—É—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —É–¥–∞–ª—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ –ø–æ SSH –∏–ª–∏ WinRM. –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–ª–æ–∫ connection. –û–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–ª–æ–∂–µ–Ω –≤ –±–ª–æ–∫–∏ resource –∏–ª–∏ provisioner. –í –ø–µ—Ä–≤–æ–º —Å–ª—É—á–∞–µ –æ–Ω –¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–∞ –≤—Å–µ –ø—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä—ã —Ä–µ—Å—É—Ä—Å–∞, –≤–æ –≤—Ç–æ—Ä–æ–º ‚Äî –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π.
–í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è –≤—Å–µ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ yandex_compute_instance –∏ –æ–±–∞ –ø—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä–∞, file –∏ remote-exec, –±—É–¥—É—Ç –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
resource "yandex_compute_instance" "web" {
...

#–ü—Ä–∏–º–µ—Ä
resource "yandex_compute_instance" "cluster" {
  count = 3

...
}

resource "terraform_data" "cluster" {

  connection {
    host = yandex_compute_instance.cluster.[0].network_interface.0.nat_ip_address
  }

  provisioner "remote-exec" {
    inline = [
      "bootstrap-cluster.sh ${join(" ", yandex_compute_instance.cluster.*.private_ip)}",
    ]
  }
}

  connection {
    type        = "ssh"
    user        = "ubuntu"
    private_key = var.private_key
    host        = self.network_interface.0.nat_ip_address
  }
  
  provisioner "file" {
    source      = "conf/app.conf"
    destination = "/etc/app.conf"
  }
  
  provisioner "remote-exec" {
    script = [
      "./bootstrap.sh"
    ]
  }
}

#–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ cloud-init
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –ø—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä–∞–º ‚Äî –∞—Ä–≥—É–º–µ–Ω—Ç user_data –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –í–ú —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ cloud-init.
–í—ã —É–∂–µ –∑–Ω–∞–∫–æ–º—ã —Å –Ω–∏–º –ø–æ –æ–¥–Ω–æ–π –∏–∑ –ø—Ä–æ—à–ª—ã—Ö –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç. –° –ø–æ–º–æ—â—å—é –Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞–ª—Å—è nginx —Å —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π.
resource "yandex_compute_instance" "this" {
... 
  metadata = {
    user-data = file("cloud-init.yaml")
  }
}

#–ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è cloud-init, —É–∫–∞–∑–∞–Ω–Ω–∞—è –Ω–∏–∂–µ, –≤—ã–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:
–û–±–Ω–æ–≤–∏—Ç —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤.
–û–±–Ω–æ–≤–∏—Ç –ø–∞–∫–µ—Ç—ã.
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç –ø–∞–∫–µ—Ç—ã nginx –∏ git.
–°–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º.
–í—ã–ø–æ–ª–Ω–∏—Ç –∫–æ–º–∞–Ω–¥—É.
#cloud-config
datasource:
  Ec2:
    strict_id: false
ssh_pwauth: no    
package_update: true
package_upgrade: true
packages:
  - nginx
  - git
write_files:
  - path: /var/www/html/index.nginx-debian.html
    content: |
      <html>
      <body>
        <h1>Hello, World!</h1>
        <p>Welcome to the example web page!</p>
      </body>
      </html> 
    owner: 'ubuntu:ubuntu'
    permissions: '0644'
runcmd:
 - [ ls, -l, / ]

#–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è cloud-init: 
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –ø—Ä–æ—Ü–µ—Å—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω –ø—Ä–∏ –∏—Ö –∑–∞–ø—É—Å–∫–µ –≤ –æ–±–ª–∞–∫–µ.
‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–æ–≤–∏–∂–µ–Ω–µ—Ä–æ–≤ Terraform.
‚úÖ –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω, —Ç–∞–∫ –∫–∞–∫ –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.  

      value_id = each.value.id
      folder_id = each.value.folder_id
      value_name = each.value.name

#CI/CD 

1Ô∏è‚É£ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–æ–¥
–î–æ–±–∞–≤–ª—è–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥.

–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –¥–æ–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥, –æ–±—ä—è—Å–Ω—è—è —Å–ª–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–ª–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –Ω–æ–≤—ã–π –∫–æ–¥ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–æ.

–ü—Ä–∏–º–µ—Ä —É–¥–∞—á–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

# –°–æ–∑–¥–∞–Ω–∏–µ YDB-–±–∞–∑—ã –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ state-—Ñ–∞–π–ª–∞
resource "yandex_ydb_database_serverless" "database" {
  name = "${var.name}-ydb"
} 
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª README.md. –í –Ω—ë–º –æ–ø–∏—Å—ã–≤–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç, —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é.
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Terraform docs –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–∞—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –û—Å–æ–±–µ–Ω–Ω–æ —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –º–æ–¥—É–ª–µ–π. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ç–∞–∫–∂–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –ø–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, —É–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. 

2Ô∏è‚É£ –û—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
–†–∞–∑–º–µ—â–∞–π—Ç–µ —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –º–æ–¥—É–ª—è —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
/terraform
‚îú‚îÄ‚îÄ main.tf
‚îú‚îÄ‚îÄ variables.tf
‚îú‚îÄ‚îÄ versions.tf
‚îú‚îÄ‚îÄ outputs.tf
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ ... 
main.tf
–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
variables.tf
–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
versions.tf
–£–∫–∞–∑–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤.
outputs.tf
–í—ã—Ö–æ–¥–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Å–ª–µ–¥—É–µ—Ç –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø–æ—Å–ª–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
README.md
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.

3Ô∏è‚É£ –†–∞–∑–¥–µ–ª—è–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞
–ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã –ø–æ –∏—Ö —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:

resource "yandex_compute_instance" "web" {
  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
}

resource "yandex_mdb_postgresql_cluster" "database" {
  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
} 
–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
–î–ª—è –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è –ø–æ–º–∏–º–æ main.tf —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, iam.tf ‚Äî —Ñ–∞–π–ª —Å –≥—Ä—É–ø–ø–æ–π —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–æ–≤:
/terraform
‚îú‚îÄ‚îÄ main.tf
‚îú‚îÄ‚îÄ iam.tf
‚îî‚îÄ‚îÄ ... 

4Ô∏è‚É£ –†–∞–∑–¥–µ–ª—è–π—Ç–µ –∫–æ–¥ –Ω–∞ –º–æ–¥—É–ª–∏
–†–∞–∑–±–∏–≤–∞–π—Ç–µ –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ –º–æ–¥—É–ª–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–¥—É–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –º–æ–¥—É–ª—å –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥ –∏ —É–ø—Ä–æ—â–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.
/modules
‚îú‚îÄ‚îÄ web_server
‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ database
‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ ... 


5Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä dev, stage, prod, —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
/
‚îú‚îÄ‚îÄ environments/
‚îÇ   ‚îú‚îÄ‚îÄ dev/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ prod/
‚îÇ       ‚îú‚îÄ‚îÄ variables.tf
‚îÇ       ‚îú‚îÄ‚îÄ main.tf
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ modules/
    ‚îú‚îÄ‚îÄ compute/
    ‚îú‚îÄ‚îÄ vpc/
    ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
    ‚îÇ   ‚îî‚îÄ‚îÄ variables.tf
    ‚îî‚îÄ‚îÄ application 


6Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥—É–ª–∏ Terraform
–ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π
–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –º–æ–¥—É–ª–∏ Terraform –∏–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–ª–∏ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, —á—Ç–æ–±—ã —É–ø—Ä–æ—Å—Ç–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É.
–í–Ω–µ—à–Ω–∏–µ –º–æ–¥—É–ª–∏
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –æ—Ç Yandex Cloud. –í–∞–º –Ω–µ –ø—Ä–∏–¥—ë—Ç—Å—è —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –∏—Ö –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤ —Å–≤–æ—ë–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–µ–≥ –Ω–∞ –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é –º–æ–¥—É–ª—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é —Å –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

# –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è VPC –æ—Ç Yandex Cloud
module "vpc" {
  source = "github.com/terraform-yc-modules/terraform-yc-vpc.git//.?ref=1.0.x"
  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª—è
}

# –õ–æ–∫–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å
module "compute" {
  source = "../../modules/compute"
  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª—è
} 


7Ô∏è‚É£–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤, —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ —à–∞–±–ª–æ–Ω–æ–≤. –í—ã–Ω–æ—Å–∏—Ç–µ –∏—Ö –≤ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏, —á—Ç–æ–±—ã —É–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É.
/
‚îú‚îÄ‚îÄ environments/
‚îÇ   ‚îú‚îÄ‚îÄ dev/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ compute/
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ scripts/
‚îú‚îÄ‚îÄ files/
‚îî‚îÄ‚îÄ templates/ 

8Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–¥–∞–ª—ë–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥ Terraform –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è state-—Ñ–∞–π–ª–∞
–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ state-—Ñ–∞–π–ª –≤ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, —Ç–∞–∫ –∫–∞–∫ state-—Ñ–∞–π–ª –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã.
–î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è state-—Ñ–∞–π–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–¥–∞–ª—ë–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥, –Ω–∞–ø—Ä–∏–º–µ—Ä S3 (Yandex Object Storage) –∏–ª–∏ Gitlab Terraform state.
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è state-—Ñ–∞–π–ª–∞.


–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ CI/CD —Å Terraform
1Ô∏è‚É£ –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É CI/CD
GitLab CI ‚Äî –Ω–∞–∏–±–æ–ª–µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è. –° –ø–æ–º–æ—â—å—é Managed Service for GitLab –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å DevOps‚Äë–ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π GitLab –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ Yandex Cloud. –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ø–Ω–¥–µ–∫—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Yandex Tracker –∏–ª–∏ Lockbox), —Ç–æ –∏—Ö —Ç–æ–∂–µ –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å.
2Ô∏è‚É£ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Terraform
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Terraform —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –≤–∞—à–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ CI/CD. –î–ª—è Gitlab CI —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ —Ä–∞–Ω–Ω–µ—Ä–æ–≤: Shell, Docker, Kubernetes –∏ —Ç. –¥. –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ —Ä–∞–Ω–Ω–µ—Ä –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –≤ Terraform.
–°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–ª–∏ –∑–∞–¥–∞—á–∏ CI/CD –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ Terraform, –Ω–∞–ø—Ä–∏–º–µ—Ä, terraform plan ‚Äî –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ terraform apply ‚Äî –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ CI/CD –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ Terraform, —Ç–∞–∫–∏—Ö –∫–∞–∫ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–ª–∞–∫–∞ –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Å–µ–∫—Ä–µ—Ç—ã.
3Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ CI/CD –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π: –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–º–æ—â—å—é tflint –∏–ª–∏ checkov. –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–∫–∞–∂–µ–º –æ–± —ç—Ç–æ–º –≤ —á–µ—Ç–≤—ë—Ä—Ç–æ–º —É—Ä–æ–∫–µ —Ç–µ–º—ã.
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
–í–∫–ª—é—á–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è Terraform –ø–æ—Å–ª–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –¥–ª—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.
4Ô∏è‚É£ –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã CI/CD
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è Terraform –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∏–ª–∏ –æ—à–∏–±–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ Telegram –∏–ª–∏ Yandex Messenger. –í—ã –ø–æ—Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç–µ—Å—å –¥–µ–ª–∞—Ç—å —ç—Ç–æ –≤ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–º —É—Ä–æ–∫–µ.
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à–∞–±–ª–æ–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ CI/CD –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Å—Ä–µ–¥ ‚Äî dev, stage, prod —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ Terraform. –ü—Ä–∏–º–µ—Ä –¥–ª—è GitLab CI.

–≤–æ –ø–µ—Ä–≤—ã—Ö –æ–ø—è—Ç—å –∂–µ –∫–≤–æ—Ç—ã, –≤–æ –≤—Ç–æ—Ä—ã—Ö –∫–∞–∫ —è –¥–æ–ª–∂–µ–Ω –ø–æ–Ω—è—Ç—å —á—Ç–æ –∫–ª—é—á —ç—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ–∞–π–ª key json –∞ –Ω–µ –µ–≥–æ –∑–∞–∫—Ä—ã—Ç—ã–π –∫–ª—é—á? –∏ —Ç—Ä–µ—Ç—å–µ –±–∞–∫–µ—Ç –∑–∞–≤–∏—Å –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞, —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –≤—Å–µ–≥–¥–∞ —É—Å–ø–µ–≤–∞–µ—Ç —Å–æ–∑–¥–∞—Å—Ç—å—Å—è, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –±–∞–∫–µ—Ç –Ω–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è, –≤ —á–µ—Ç–≤–µ—Ä—Ç—ã—Ö –ø–æ—á–µ–º—É –Ω–∏—á–µ–≥–æ –Ω–µ —Å–∫–∞–∑–∞–Ω–æ –ø—Ä–æ —Ç–æ —á—Ç–æ backend —Ñ–∞–π–ª –Ω—É–∂–µ–Ω —É–¥–∞–ª—è—Ç—å –ø–æ—Å–ª–µ –±–∞–∫–µ—Ç–∞?


-------
üöÄ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å Terraform –∏ GitLab CI
–°–æ–∑–¥–∞–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ —Ñ–∞–π–ª—ã: main.tf, yc-terraform-state-lock.tf.

–û–ø–∏—à–∏ —Ä–µ—Å—É—Ä—Å –í–ú: —Å Docker-–æ–±—Ä–∞–∑–æ–º –¥–ª—è GitLab Runner –∏ SSH-–¥–æ—Å—Ç—É–ø–æ–º.

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π Terraform: terraform init.

–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
export YC_TOKEN=$(yc iam create-token)
export YC_CLOUD_ID=$(yc config get cloud-id)
export YC_FOLDER_ID=$(yc config get folder-id)
export AWS_ACCESS_KEY_ID="mock_access_key"
export AWS_SECRET_ACCESS_KEY="mock_secret_key" 
–ó–∞–ø—É—Å—Ç–∏ –ø–ª–∞–Ω –∏ –ø—Ä–∏–º–µ–Ω—è–π: terraform plan, terraform apply.

–°–æ—Ö—Ä–∞–Ω–∏ backend-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞: .env, .key.json.

üõ†Ô∏è –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Managed GitLab
–°–æ–∑–¥–∞–π –∏–Ω—Å—Ç–∞–Ω—Å GitLab –≤ Yandex Cloud.

–£–∫–∞–∂–∏ –∏–º—è, –ø–æ–¥—Å–µ—Ç—å, –¥–æ–º–µ–Ω –∏ email.

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è ‚Äî —Å–±—Ä–æ—Å—å –ø–∞—Ä–æ–ª—å, –∑–∞–π–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ –ø–∏—Å—å–º–∞.

üìÅ GitLab-–ø—Ä–æ–µ–∫—Ç –∏ Runner
–°–æ–∑–¥–∞–π –ø—Ä–æ–µ–∫—Ç –≤ GitLab, –¥–æ–±–∞–≤—å —Ñ–∞–π–ª—ã: main.tf, provider.tf, backend.tf.

–î–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Settings ‚Üí CI/CD ‚Üí Variables:

AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY

YC_CLOUD_ID, YC_FOLDER_ID, YC_KEY

–ü–æ–ª—É—á–∏ –∫–æ–º–∞–Ω–¥—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ GitLab Runner.

–ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –í–ú –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π Runner (executor ‚Äî Docker).

–ü—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Runner'–∞.

‚öôÔ∏è GitLab CI pipeline
–°–æ–∑–¥–∞–π .gitlab-ci.yml —Å —Ç—Ä–µ–º—è —Å—Ç–∞–¥–∏—è–º–∏: validate, plan, apply.

–£–±–µ–¥–∏—Å—å, —á—Ç–æ validate –∏ plan –ø—Ä–æ—à–ª–∏.

–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ apply ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è.

–ü—Ä–æ–≤–µ—Ä—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –≤ Yandex Cloud.

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –∑–∞–ø—É—Å—Ç–∏ destroy –≤—Ä—É—á–Ω—É—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.